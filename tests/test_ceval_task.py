import pytest

@pytest.mark.usefixtures('task')
@pytest.mark.parametrize("task", ("ceval",), indirect=True)
class TestCevalTask:
    completaions = [
        '计算机网络的资源主要是指可以被共享和利用的各种设备、软件和数据等。因此，选项A中的服务器、路由器、通信线路与用户计算机是计算机网络中的资源，选项B中的计算机操作系统、数据库与应用软件是计算机系统中的资源，选项C中的计算机硬件、软件与数据是计算机系统中的资源，选项D中的Web服务器、数据库服务器与文件服务器是网络中的服务器资源。综上所述，选项A是正确答案。',
        '首先，停止-等待协议的信道最大利用率为0.8，即80%。 其次，信道的数据传输率为4kb/s，即每秒可以传输4kbit的数据。 因此，每秒钟可以传输的比特数为4k x 0.8 = 3.2kbit。 接下来，考虑单向传播时延为30ms，即数据从发送端到接收端需要30ms的时间。 因此，在这30ms的时间内，可以传输的比特数为3.2k x 0.03 = 96bit。 最后，根据停止-等待协议的特点，每发送一个数据帧后需要等待确认帧才能发送下一个数据帧。 因此，数据帧长度至少应该为96bit加上确认帧的长度。 根据常见的确认帧长度为32bit，可得数据帧长度至少为96+32=128bit。 因此，选项A的160bit是符合要求',
        '首先，主机甲已经发送了两个最大段，每个最大段长度为1000字节，因此已经发送了2000字节。 其次，主机乙通告的接收窗口大小为2000字节，表示主机乙还有2000字节的缓冲区可以接收数据。 最后，主机甲的当前拥塞窗口为4000字节，表示主机甲还可以发送4000字节的数据。 因此，主机甲还可以向主机乙发送的最大字节数是2000字节，即选项B。',
        '在CSMA的非坚持协议中，当站点侦听到总线媒体空闲时，它会以概率p传送数据。因为非坚持协议允许站点在侦听到媒体空闲后立即发送数据，但如果多个站点同时发送数据，就会发生冲突。为了避免冲突，站点会以一定的概率p发送数据，如果发送失败，则等待一段时间后再次尝试发送。因此，选项A是正确答案。',
        'D. ipconfig不是Linux命令，它是Windows命令。在Linux中，可以使用ifconfig、ip和ethtool等命令来配置和管理网络接口。',
        'TCP的滑动窗口协议中，重传分组的数量最多可以等于滑动窗口的大小。因为TCP的滑动窗口协议中，发送方维护了一个滑动窗口，用于控制发送数据的数量。当接收方收到数据后，会发送一个确认消息给发送方，告诉发送方已经成功接收到数据。如果发送方在规定的时间内没有收到确认消息，就会认为数据丢失，需要进行重传。因此，重传分组的数量最多可以等于滑动窗口的大小。选项D是正确答案。',
        '当一方发送带有FIN标志的数据段时，表示该方已经没有数据要发送了，即该方已经完成了数据传输任务。因此，选项B是正确的，表示单方面释放连接，表示本方已经无数据发送，但可以接收对方的数据。选项A是错误的，因为FIN标志只是表示该方已经完成了数据传输任务，但并不代表要断开连接。选项C也是错误的，因为双方都可以继续接收数据，只是该方已经没有数据要发送了。选项D也是错误的，因为FIN标志并不会重新建立连接。',
        '根据后退N帧协议，当收到N个确认时，表示编号为0到N-1的帧都已经被成功接收，可以继续发送编号为N到2N-1的帧。在这道题中，发送方已经发送了编号0到6的帧，但只收到了对1、3和5号帧的确认，说明编号为0、2、4、6的帧都还没有被成功接收。因此，需要重传的帧的数目是4，即选项B。',
        '数据链路层的主要功能是将物理层提供的比特流转换为有意义的帧，并在帧之间提供可靠的传输。因此，帧同步和差错控制是数据链路层的基本功能，而流量控制和拥塞控制则属于传输层的功能。因此，选项B中的Ⅰ、Ⅱ、Ⅳ是正确的答案。',
        '超时重传和确认捎带技术都是为了实现可靠的服务，其中确认捎带技术是在确认信息中捎带一些额外的信息，以减少通信量。根据题目描述，传输中的协议规定，在确认信息中捎带什么样的序号呢？根据常识，序号应该是指报文的序号，因为在传输中，每个报文都有一个唯一的序号。因此，选项B下一个希望接收的报文是正确答案。',
        'TCP中滑动窗口的值设置太大，会导致主机发送的数据包数量增多，从而使得网络拥塞，可能会出现丢包的情况，因此选项A是正确答案。选项B是不正确的，因为ACK是确认接收到数据的信号，滑动窗口的大小不会影响ACK的产生。选项C和D也是不正确的，因为滑动窗口的大小不会直接影响主机的工作速度。',
        '海明码的冗余位数应该满足 $2^r \geq m + r + 1$，其中 $m$ 为信息位数，$r$ 为冗余位数。因为要纠正一位错误，所以 $r$ 至少要满足 $2^r \geq m + r + 1 + 1$，即 $2^r \geq 10$。因为 $r$ 是整数，所以 $r$ 至少为 4，因此选项 B 正确，冗余位至少应为 4 位。',
        'TCP采用滑动窗口协议解决了端到端的流量控制和网络的拥塞控制，因此选项C是正确答案。TCP的滑动窗口协议可以根据接收方的处理能力和网络状况动态调整发送方的发送速率，从而实现流量控制和拥塞控制。而差错控制则是通过TCP的校验和和确认机制来实现的。',
        '服务访问点是上下邻层实体之间的接口，应用层的服务访问点也称为什么？根据计算机网络的知识，应用层是最高层，负责为应用程序提供服务，因此应用层的服务访问点也称为用户界面，选项A正确。选项B是数据链路层的接口，选项C是网络层的地址，选项D是数据链路层的地址，都不是应用层服务访问点的称呼。',
        '首先，OSI参考模型共有七层，自下而上依次为物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。 其次，端到端服务是指从源主机到目的主机的通信服务。 因此，提供端到端服务的层次应该是传输层，选项B正确。',
        '首先，熟知端口号是指在TCP/IP协议中，被固定分配给某些服务或应用程序的端口号，范围是0~1023。因此，选项A不正确。 确认端口号并不是一个常见的术语，因此选项B也不正确。 客户端口号是指在TCP/IP协议中，由客户端随机分配的端口号，范围是1024~65535。因此，选项C不正确。 临时端口号是指在TCP/IP协议中，由客户端随机分配的端口号，用于与服务器进行通信，范围也是1024~65535。因此，选项D是正确答案。',
        'A. 这是正确的说法，带r个校验位的多项式编码可以检测所有长度小于或等于r的突发性错误。 B. 这是正确的说法，通信双方可以无须商定就直接使用多项式编码。 C. 这是正确的说法，CRC可以使用硬件来完成。 D. 这是错误的说法，CRC只能检测出大部分比特差错，但不能检测出所有比特差错，因此不能实现无比特差错的传输。同时，CRC只能检测出比特差错，但不能纠正比特差错，因此不能实现可靠的传输。 综上所述，选项D是错误的。',
        '物理层是计算机网络的最底层，主要负责传输比特流，因此其四个重要特性都与传输有关。机械特性指的是物理层的接口形状、尺寸、引脚数目等机械特征；电气特性指的是传输介质的电气特性，如电压、电流、阻抗等；功能特性指的是物理层的传输速率、传输距离、时延等功能特征。因此，正确答案应该是A. 接口特性。',
        '第一个TCP段的序列号为200，有效载荷为300字节，因此下一个TCP段的序列号应该是200+300=500。 第二个TCP段的序列号为500，有效载荷为500字节，因此下一个TCP段的序列号应该是500+500=1000。 因此，主机乙发送给主机甲的确认序列号应该是1000。选项D为正确答案。',
        '在OSI参考模型中，数据的封装过程是由各个层次依次完成的。因此，正确答案应该是B. 传输层。传输层负责将应用层的数据进行分段，并为每个分段添加传输层的首部和尾部，形成传输层的数据包。这个过程就是数据的封装过程。',
        '对网络模型进行分层的目标是为了增加功能之间的独立性，使得每一层都可以独立地设计、实现和修改，而不会影响到其他层。因此，选项D是正确答案。A、B、C三个选项都是对网络模型进行分层的目标之一。',
        '首先，以太网是一种局域网技术，它的MAC子层负责处理数据帧的传输和接收。其次，IEEE是国际电气电子工程师协会，它制定了许多网络标准。因此，正确答案应该是B. IEEE 802.3，因为IEEE 802.3标准规定了以太网的MAC子层的工作原理和规范。',
        'CDMA是码分多址技术，每个用户使用不同的码，不会发生冲突； CSMA是载波监听多路访问技术，如果同时有多个节点发送数据，会发生冲突； TDMA是时分多路复用技术，每个节点在不同的时间段发送数据，不会发生冲突； FDMA是频分多路复用技术，每个节点使用不同的频率发送数据，不会发生冲突。 因此，可能发生冲突的是B. CSMA。',
        'TDM是时分复用技术，它将多个信号按照时间分割后，依次发送到传输介质上。因此，TDM所利用的传输介质的性质应该是能够支持高速数据传输，且带宽足够大，能够容纳多个信号的传输。因此，选项A“介质的带宽大于结合信号的位速率”是正确答案。',
        '因特网采用的核心技术是A. TCP/IP。TCP/IP是因特网的基础协议，它包括传输控制协议（TCP）和互联网协议（IP），用于在因特网上进行数据传输和路由选择。局域网技术、远程通信技术和光纤技术都是因特网的支撑技术，但不是其核心技术。',
        '根据选择重传协议的原则，发送方只会重传未被确认的帧，因此选项D是正确的。具体来说，如果否定性确认帧指示的是序号为1的帧出现了错误，那么发送方会重传序号为1的帧；如果指示的是序号为2的帧出现了错误，那么发送方会重传序号为2的帧；如果指示的是序号为3的帧出现了错误，那么发送方会重传序号为3的帧。',
        '基带传输是指将数字信号直接传输到传输介质上，不经过调制的传输方式。因此，选项D，数字数据的数字传输，是正确答案。选项A、B、C都涉及模拟信号的传输，与基带传输不符。',
        'TCP/IP模型中，网络接口层主要处理物理层和数据链路层的协议，负责将数据帧从一个网络传输到另一个网络。网际层主要处理IP协议，负责将数据包从源主机传输到目的主机。应用层处理特定的应用程序协议，如HTTP、FTP等。因此，正确答案应该是C. 传输层，它处理关于可靠性、流量控制和错误校正等问题，包括TCP和UDP协议。',
        '停止-等待协议是一种可靠传输协议，其主要目的是确保数据的可靠传输。在该协议中，发送方发送数据后会启动一个计时器，如果在规定时间内没有收到确认信息，就会触发超时重发机制，重新发送数据。因此，选项C“超时重发”是使用计时器的主要目的。选项A、B、D都与计时器的使用无关。',
        'B. 由自治的计算机互联起来的集合体。计算机网络是由多台计算机通过通信设备相互连接起来，实现资源共享和信息传输的系统。选项A描述的是计算机软件模块，选项C描述的是共享内存的紧耦合系统，选项D描述的是分布式系统，都与计算机网络的定义不符。',
        '首先，一个完全窗口可以发送的报文段数量为24KB/2KB=12个。 其次，在慢开始阶段，每经过一个往返时延RTT，窗口大小就会翻倍。因此，发送方发送出第一个完全窗口需要经过的往返时延RTT数量为log2(12)=3.58，向上取整为4个往返时延RTT。 因此，发送方发送出第一个完全窗口需要的时间为4*10ms=40ms，选项B为正确答案。',
        '在OSI参考模型中，路由器实现的最高功能层是第三层网络层，交换机Switch实现的最高功能层是第二层数据链路层，集线器Hub实现的最高功能层是第一层物理层。因此，选项C是正确答案，即路由器实现的最高功能层是第三层，交换机Switch实现的最高功能层是第二层，集线器Hub实现的最高功能层是第一层。',
        'A. 正确，TCP连接建立需要经过“三次握手”的过程，即客户端发送SYN包，服务器端回复SYN+ACK包，客户端再回复ACK包。 B. 正确，TCP传输连接建立之后，客户端与服务器端的应用进程进行全双工的字节流传输。 C. 错误，TCP传输连接的释放过程相对于建立过程来说比较简单，客户端和服务器端都可以主动提出释放连接的请求。 D. 错误，TCP连接的释放需要经过“四次挥手”的过程，即客户端发送FIN包，服务器端回复ACK包，服务器端发送FIN包，客户端回复ACK包。 因此，选项C是错误的。',
        '对于EMAIL，发送邮件使用SMTP协议，接收邮件使用POP3/IMAP协议，因此选项B是正确的。选项A和C都有错误，而选项D则是完全错误的。',
        '根据题目描述，只有选项A符合特征。因为奇偶校验码只能检查出奇数个比特错误，不能检查出偶数个比特错误，所以Ⅰ是正确的。而奇偶校验码只能检查出一个比特位的错误，不能检查出多个比特位的错误，所以Ⅱ是错误的。相比之下，CRC更加可靠，所以Ⅲ也是错误的。因此，选项A是正确答案。',
        '这种方式是指持续监听信道直到空闲，因此是一种坚持型的CSMA协议。选项B“坚持型CSMA”是正确答案。',
        '在发生超时后，TCP会将慢开始门限值设置为当前拥塞窗口的一半，即4。同时，拥塞窗口的大小会被重置为1，开始慢启动。每经过一个往返时间RTT，拥塞窗口大小就会加倍，即2、4、8。当拥塞窗口大小达到慢开始门限值时，TCP就会进入拥塞避免阶段，每经过一个RTT，拥塞窗口大小就会增加1，即9、10、11、12、13。因此，第13次传输时拥塞窗口的大小为7，选C。',
        '局域网访问冲突的根源是B.共享介质。在局域网中，多个设备共享同一介质（如同一根网线），当多个设备同时发送数据时，就会发生冲突，导致数据传输失败。为了解决这个问题，可以采用CSMA/CD协议来协调设备之间的数据传输。',
        'TCP协议中的窗口大小是指发送方可以发送的数据量，而不是接收方可以接收的数据量。因此，答案应该是D，发送方的窗口大小取决于发送方允许的窗口和拥塞窗口。发送方允许的窗口大小取决于接收方允许的窗口大小和网络拥塞情况，而拥塞窗口大小则是根据网络拥塞程度动态调整的。',
        '在计算机网络中，可以没有的是D.数据库管理系统。虽然数据库管理系统在计算机网络中扮演着重要的角色，但是它并不是计算机网络中必须要有的组成部分。客户机、服务器和操作系统都是计算机网络中必不可少的组成部分。',
        '根据题目所述，计算机网络分为广域网、城域网和局域网，其划分的主要依据是什么？选项A、C、D都不太符合，因为网络的作用范围、通信方式和传输介质并不能完全决定网络的类型。而选项B，网络的拓扑结构，也不能完全决定网络的类型，因为同一种拓扑结构的网络可能会被划分为不同的类型。因此，正确答案应该是A，网络的作用范围。广域网覆盖范围最广，城域网次之，局域网覆盖范围最小。',
        '计算机网络拓扑结构主要取决于它的通信子网，因为拓扑结构是指计算机网络中各个节点之间的物理连接方式，而这些物理连接方式是通过通信子网来实现的。因此，选项C是正确答案。资源子网、路由器和交换机都是计算机网络中的重要组成部分，但它们并不直接决定网络的拓扑结构。',
    ]

    def test_extract(self, task):
        labels = ['A','A','B','A','D','D','B','B','B','B','A',None,'C',None,'B','D',None,'A','D','B','D','B','B','A','A','D','D','C','C','B','B','C',None,'B','A','B','C','B','D','D','A','C']
        ans = []
        for completaion in self.completaions:
            ans.append(task.extract(completaion))
        assert ans == labels
